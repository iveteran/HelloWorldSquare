# vim:ft=lf
# lf/bindings.conf
# @author nate zhou
# since 2025

# disable default bindings
map ','
map '.'
map "'"
map '"'
map 'm'
map 't'
map '['
map ']'

# visual mode
vmap c visual-change

# command mode
cmap <c-g>      cmd-escape
cmap <c-f>      cmd-right
cmap <c-b>      cmd-left
cmap <c-a>      cmd-home
cmap <c-e>      cmd-end
cmap <c-n>      cmd-menu-complete
cmap <tab>      cmd-menu-complete
cmap <c-p>      cmd-menu-complete-back
cmap <backtab>  cmd-menu-complete-back

# normal & visual mode
map .r source ~/.config/lf/lfrc

map <c-n> half-down
map <c-p> half-up
map H     jump-prev
map L     jump-next
map J : {{
    toggle
    down
}}
map K : {{
    toggle
    up
}}

map t : {{
    tag-toggle
    down
}}

map i $~/.config/lf/scope.sh $f | less -R
map e $$EDITOR "$f"
map E &footclient nvim $f

map f :filter
map D delete

map a :rename
map A :rename; cmd-end
map I :rename; cmd-home
map r push a<c-u>
map R push A<c-u>

map w $$SHELL
map ` !true

map U !du -csh $fx
map Y $printf '%s' "$fx" | wl-copy
map W $~/.local/bin/setwall $f

map sa :{{
    set sortby atime
    set info size:atime
    set noreverse
}}
map sA :{{
    set sortby atime
    set info size:atime
    set reverse
}}
map sb :{{
    set sortby btime
    set info size:btime
    set noreverse
}}
map sB :{{
    set sortby btime
    set info size:btime
    set reverse
}}
map sc :{{
    set sortby ctime
    set info size:ctime
    set noreverse
}}
map sC :{{
    set sortby ctime
    set info size:ctime
    set reverse
}}
map se :{{
    set sortby ext
    set info size:time
    set noreverse
}}
map sE :{{
    set sortby ext
    set info size:time
    set reverse
}}
map sn :{{
    set sortby natural
    set info size:time
    set noreverse

}}
map sN :{{
    set sortby natural
    set info size:time
    set reverse

}}
map ss :{{
    set sortby size
    set info size:time
    set noreverse
}}
map sS :{{
    set sortby size
    set info size:time
    set reverse
}}
map st :{{
    set sortby time
    set info size:time
    set noreverse
}}
map sT :{{
    set sortby time
    set info size:time
    set reverse
}}

map zp toggle-preview
map zc :{{
    set dircounts!
    calcdirsize
}}
map zd :{{
    set dironly!
}}

map zf :{{
    set dirfirst!
}}

# FSH
map br cd /
map b/ cd /
map bh cd ~
map be cd /etc
map bu cd /usr
map bd cd /dev
map bo cd /opt
map bv cd /var
map bm cd /mnt
map bt cd /tmp
map bi cd /run/media/

# gpg
map Sr $~/.local/bin/seal --rifle $f
map Sc $~/.local/bin/seal --cipher $f
map Se $~/.local/bin/seal --encrypt $f
map Sd $~/.local/bin/seal --decrypt $f
map Ss $~/.local/bin/seal --sign $f
map Sv $~/.local/bin/seal --verify $f | less
map gK $pacman-key --verify $f | less -Ri
map gd $~/.local/bin/gpg-doc $f
map gp $~/.local/bin/gpg-pic $f
map gv $~/.local/bin/gpg-vid $f
map gm $~/.local/bin/gpg-mus $f

## git
map gl $clear; GIT_PAGER="less -+F -R" git log --graph --pretty=format:'%Cred%h%Creset%C(yellow)%d%Creset %s%Cgreen(%cr)' --abbrev-commit
map gs $clear; git status -v | less -i
map gh $clear; git log --graph --pretty=format:'%Cred%h%Creset%C(yellow)%d%Creset %s%Cgreen(%cr)' --abbrev-commit | /usr/bin/fzf --layout=reverse-list --preview-window=80%:bottom: --preview 'parse-fgl {}' --color | cut -d' ' -f2 | xargs -I{} git rev-parse {} | wl-copy
map gf $clear;  /usr/bin/fzf --preview 'git log --follow -p {} | bat --color=always --style=plain,changes' --preview-window=80%:bottom:
map gF $clear; git log --follow -p "$(basename $f)"

# Create archive & compression
map Ct $tar cvf "$f.tar" "$(basename $f)"
map Cz $zip -r "$f.zip" "$(basename $f)"
map Cg $gzip -k $f
map CG $tar czvf "$f.tar.gz" "$(basename $f)"
map Cb $bzip2 -k $f
map CB $tar cjvf "$f.tar.bz2" "$(basename $f)"
map Cx $xz -k $f
map CX $tar cJvf "$f.tar.xz" "$(basename $f)"
map Cs $zstd -zk $f
map CS $tar cvf "$f.tar.zst" "$(basename $f)" --zstd

# metadata
map mi $mid3v2 -l $f | less -i
map mm $mediainfo $f | less -i
map me $exiftool $f | less -i
map mf %file -Lb --mime-type $f | tr '\n' ' '
map mF $file -L --mime-type $fx | less -i
map ma $lsattr -d $(realpath $fx) | less -i
map mA $getfacl $fx | less -i
map mg $iconv -f GBK -t UTF-8 $f | less -i

map xs $swayimg -r
map xR $~/.local/bin/rename-dlp $fx
map xL $~/.local/bin/rename-lowercase $fx
map xS $~/.local/bin/rename-space $fx
map xt $~/.local/bin/id3title $fx
map xT $~/.local/bin/id3trck $fx
